html_element("span.author-name") %>%
html_text()
autor  <- noticia %>%
html_element("span.author-name") %>%
html_text() %>%
str_squish()
autor
tabla_noticias <- function(links){
noticia <- read_html(links)
titulo <- noticia %>%
html_element("h1.title") %>%
html_text() %>%
str_squish()
resumen <-  noticia %>%
html_element("div.summary") %>%
html_text() %>%
str_squish()
cuerpo <- noticia %>%
html_elements("p") %>%
html_text() %>%
str_squish() %>%
paste(collapse = '\"', "")
cuerpo <- gsub('\\"', "", cuerpo)
fecha  <- noticia %>%
html_element("span.content-meta-date-created") %>%
html_text() %>%
str_squish()
fecha <- str_sub(fecha,1,9)
fecha <- dmy(fecha)
autor  <- noticia %>%
html_element("span.author-name") %>%
html_text() %>%
str_squish()
tabla_final <- as.data.frame(cbind("titulo"=titulo, "autor" = autor, "resumen"=resumen,  "cuerpo"=cuerpo,"fecha" = fecha))
return(tabla_final)
}
links_completos[1]
resultado <-  tabla_noticias(links_completos[1])
View(resultado)
tabla_noticias <- function(links){
noticia <- read_html(links)
titulo <- noticia %>%
html_element("h1.title") %>%
html_text() %>%
str_squish()
resumen <-  noticia %>%
html_element("div.summary") %>%
html_text() %>%
str_squish()
cuerpo <- noticia %>%
html_elements("p") %>%
html_text() %>%
str_squish() %>%
paste(collapse = '\"', "")
cuerpo <- gsub('\\"', "", cuerpo)
fecha  <- noticia %>%
html_element("span.content-meta-date-created") %>%
html_text() %>%
str_squish()
fecha <- str_sub(fecha,1,9)
#fecha <- dmy(fecha)
autor  <- noticia %>%
html_element("span.author-name") %>%
html_text() %>%
str_squish()
tabla_final <- as.data.frame(cbind("titulo"=titulo, "autor" = autor, "resumen"=resumen,  "cuerpo"=cuerpo,"fecha" = fecha))
return(tabla_final)
}
resultado <-  tabla_noticias(links_completos[1])
View(resultado)
resultado <-  tabla_noticias(links_completos[2])
View(resultado)
resultado$cuerpo
1:length(links_completos)
noticias <- tibble(
titulo=character(),
resumen=character(),
cuerpo=character(),
fecha=character(),
autor= character()
)
View(noticias)
for(i in 1:length(links_completos)){
print(paste("Se encontraron", length(links_completos), "noticias"))
print(paste("Descargando informacion de noticia", i, "de", length(links_completos)))
resultado <- tabla_noticias(links_completos[i])
noticias <- noticias %>%
bind_rows(resultado)
}
View(noticias)
tabla_noticias <- function(links){
noticia <- read_html(links)
titulo <- noticia %>%
html_element("h1.title") %>%
html_text() %>%
str_squish()
resumen <-  noticia %>%
html_element("div.summary") %>%
html_text() %>%
str_squish()
cuerpo <- noticia %>%
html_elements("p") %>%
html_text() %>%
str_squish() %>%
paste(collapse = '\"', "")
cuerpo <- gsub('\\"', "", cuerpo)
fecha  <- noticia %>%
html_element("span.content-meta-date-created") %>%
html_text() %>%
str_squish()
fecha <- str_sub(fecha,1,9)
#fecha <- dmy(fecha)
autor  <- noticia %>%
html_element("span.author-name") %>%
html_text() %>%
str_squish()
link = links
tabla_final <- as.data.frame(cbind("titulo"=titulo, "autor" = autor, "resumen"=resumen,  "cuerpo"=cuerpo,"fecha" = fecha, "link" = link))
return(tabla_final)
}
resultado <-  tabla_noticias(links_completos[2])
View(resultado)
noticias <- tibble(
titulo=character(),
resumen=character(),
cuerpo=character(),
fecha=character(),
autor= character(),
link= character()
)
for(i in 1:length(links_completos)){
print(paste("Se encontraron", length(links_completos), "noticias"))
print(paste("Descargando informacion de noticia", i, "de", length(links_completos)))
resultado <- tabla_noticias(links_completos[i])
noticias <- noticias %>%
bind_rows(resultado)
}
View(noticias)
noticias$link[16]
noticia <- read_html("https://www.diariodepontevedra.es/video/mundo/mas-80-heridos-48-detenidos-disturbios-registrados-buenos-aires/20171219014737957087.html")
cuerpo <- noticia %>%
html_elements("p") %>%
html_text() %>%
str_squish() %>%
paste(collapse = '\"', "")
cuerpo
noticia %>%
html_elements("div.body mundo text-white") %>%
html_text() %>%
str_squish()
noticia %>%
html_elements("div.body-mundo-text-white") %>%
html_text() %>%
str_squish()
noticia %>%
html_elements("div.body-mundo") %>%
html_text() %>%
str_squish()
noticia %>%
html_elements("div.body") %>%
html_text() %>%
str_squish()
View(noticias)
noticias$link[5]
noticias$cuerpo[5]
noticias$cuerpo[6]
noticias$cuerpo[6] == noticias$cuerpo[6]
texto_indeseado <- "Lepanto 5, Pontevedra Tlfno: 986 011 100 (Grupo El Progreso) "
tabla_noticias <- function(links){
noticia <- read_html(links)
titulo <- noticia %>%
html_element("h1.title") %>%
html_text() %>%
str_squish()
resumen <-  noticia %>%
html_element("div.summary") %>%
html_text() %>%
str_squish()
cuerpo <- noticia %>%
html_elements("p") %>%
html_text() %>%
str_squish() %>%
paste(collapse = '\"', "")
texto_indeseado <- "Lepanto 5, Pontevedra Tlfno: 986 011 100 (Grupo El Progreso) "
if(cuerpo == texto_indeseado){
cuerpo <- noticia %>%
html_element("div.body") %>%
html_text() %>%
str_squish()
}
cuerpo <- gsub('\\"', "", cuerpo)
fecha  <- noticia %>%
html_element("span.content-meta-date-created") %>%
html_text() %>%
str_squish()
fecha <- str_sub(fecha,1,9)
#fecha <- dmy(fecha)
autor  <- noticia %>%
html_element("span.author-name") %>%
html_text() %>%
str_squish()
link = links
tabla_final <- as.data.frame(cbind("titulo"=titulo, "autor" = autor, "resumen"=resumen,  "cuerpo"=cuerpo,"fecha" = fecha, "link" = link))
return(tabla_final)
}
resultado <-  tabla_noticias(links_completos[6])
View(resultado)
resultado$cuerpo
texto_indeseado <-str_squish("Lepanto 5, Pontevedra Tlfno: 986 011 100 (Grupo El Progreso) ")
texto_indeseado
tabla_noticias <- function(links){
noticia <- read_html(links)
titulo <- noticia %>%
html_element("h1.title") %>%
html_text() %>%
str_squish()
resumen <-  noticia %>%
html_element("div.summary") %>%
html_text() %>%
str_squish()
cuerpo <- noticia %>%
html_elements("p") %>%
html_text() %>%
str_squish() %>%
paste(collapse = '\"', "")
texto_indeseado <-str_squish("Lepanto 5, Pontevedra Tlfno: 986 011 100 (Grupo El Progreso) ")
if(cuerpo == texto_indeseado){
cuerpo <- noticia %>%
html_element("div.body") %>%
html_text() %>%
str_squish()
}
cuerpo <- gsub('\\"', "", cuerpo)
fecha  <- noticia %>%
html_element("span.content-meta-date-created") %>%
html_text() %>%
str_squish()
fecha <- str_sub(fecha,1,9)
#fecha <- dmy(fecha)
autor  <- noticia %>%
html_element("span.author-name") %>%
html_text() %>%
str_squish()
link = links
tabla_final <- as.data.frame(cbind("titulo"=titulo, "autor" = autor, "resumen"=resumen,  "cuerpo"=cuerpo,"fecha" = fecha, "link" = link))
return(tabla_final)
}
resultado <-  tabla_noticias(links_completos[6])
View(resultado)
noticia <- read_html(links_completos[6])
cuerpo <- noticia %>%
html_elements("p") %>%
html_text() %>%
str_squish() %>%
paste(collapse = '\"', "")
cuerpo
cuerpo <- noticia %>%
html_elements("p") %>%
html_text() %>%
str_squish() %>%
paste(collapse = '\"', "")
cuerpo
texto_indeseado
cuerpo <- gsub('\\"', "", cuerpo)
cuerpo
texto_indeseado
cuerpo
texto_indeseado
cuerpo <- gsub('\\"', "", cuerpo) %>%
str_squish()
cuerpo
texto_indeseado <-"Lepanto 5, Pontevedra Tlfno: 986 011 100 (Grupo El Progreso)"
cuerpo == texto_indeseado
tabla_noticias <- function(links){
noticia <- read_html(links)
titulo <- noticia %>%
html_element("h1.title") %>%
html_text() %>%
str_squish()
resumen <-  noticia %>%
html_element("div.summary") %>%
html_text() %>%
str_squish()
cuerpo <- noticia %>%
html_elements("p") %>%
html_text() %>%
str_squish() %>%
paste(collapse = '\"', "")
cuerpo <- gsub('\\"', "", cuerpo) %>%
str_squish()
texto_indeseado <-"Lepanto 5, Pontevedra Tlfno: 986 011 100 (Grupo El Progreso)"
if(cuerpo == texto_indeseado){
cuerpo <- noticia %>%
html_element("div.body") %>%
html_text() %>%
str_squish()
}
fecha  <- noticia %>%
html_element("span.content-meta-date-created") %>%
html_text() %>%
str_squish()
fecha <- str_sub(fecha,1,9)
#fecha <- dmy(fecha)
autor  <- noticia %>%
html_element("span.author-name") %>%
html_text() %>%
str_squish()
link = links
tabla_final <- as.data.frame(cbind("titulo"=titulo, "autor" = autor, "resumen"=resumen,  "cuerpo"=cuerpo,"fecha" = fecha, "link" = link))
return(tabla_final)
}
resultado <-  tabla_noticias(links_completos[6])
View(resultado)
noticias <- tibble(
titulo=character(),
resumen=character(),
cuerpo=character(),
fecha=character(),
autor= character(),
link= character()
)
for(i in 1:length(links_completos)){
print(paste("Se encontraron", length(links_completos), "noticias"))
print(paste("Descargando informacion de noticia", i, "de", length(links_completos)))
resultado <- tabla_noticias(links_completos[i])
noticias <- noticias %>%
bind_rows(resultado)
}
View(noticias)
noticias$link[43]
nube <- function(tabla){
tabla_2 <- noticias %>%
select(cuerpo)
tabla_2 <- tabla_2 %>%
mutate(cuerpo = str_to_lower(cuerpo))
tabla_2$cuerpo <- gsub("\\.\\(function\\(.*?\\)\\);", "", tabla_2$cuerpo)
webs <- rx() %>%
rx_find('http')%>%
rx_anything_but(value = ' ')
tabla_2$cuerpo <- str_replace_all(tabla_2$cuerpo, "tlfno", "")
tabla_2$cuerpo <- gsub(webs, "", tabla_2$cuerpo)
pic <- rx() %>% rx_find('pic.')%>%
rx_anything_but(value = ' ')
tabla_2$cuerpo <- str_replace_all(tabla_2$cuerpo, pic, "")
hasthag_mencion <- "(@|#)([^ ]*)"
tabla_2$cuerpo <- str_replace_all(tabla_2$cuerpo, hasthag_mencion, "")
tabla_2 <- tabla_2 %>%
mutate(cuerpo = str_replace_all(cuerpo, "[[:digit:]]", ''))
stop_words <- as.data.frame(readLines("./data/stopwords.txt", encoding = "utf-8")) %>%     rename(word= 1)
unigram <- tabla_2 %>%
unnest_tokens(output = word, input= cuerpo, token = "ngrams", n=1) %>%
na.omit() %>%
anti_join(stop_words)
nube_f <- unigram %>%
count(word, sort =TRUE)
return(nube_f)
}
View(noticias)
webs <- rx() %>%
rx_find('http')%>%
rx_anything_but(value = ' ')
webs
hasthag_mencion <- "(@|#)([^ ]*)"
hasthag_mencion
stop_words <- as.data.frame(readLines("./data/stopwords.txt", encoding = "utf-8")) %>%     rename(word= 1)
View(stop_words)
nube <- function(tabla){
tabla_2 <- tabla %>%
select(cuerpo)
tabla_2 <- tabla_2 %>%
mutate(cuerpo = str_to_lower(cuerpo))
tabla_2$cuerpo <- gsub("\\.\\(function\\(.*?\\)\\);", "", tabla_2$cuerpo)
webs <- rx() %>%
rx_find('http')%>%
rx_anything_but(value = ' ')
tabla_2$cuerpo <- str_replace_all(tabla_2$cuerpo, "tlfno", "")
tabla_2$cuerpo <- gsub(webs, "", tabla_2$cuerpo)
pic <- rx() %>% rx_find('pic.')%>%
rx_anything_but(value = ' ')
tabla_2$cuerpo <- str_replace_all(tabla_2$cuerpo, pic, "")
hasthag_mencion <- "(@|#)([^ ]*)"
tabla_2$cuerpo <- str_replace_all(tabla_2$cuerpo, hasthag_mencion, "")
tabla_2 <- tabla_2 %>%
mutate(cuerpo = str_replace_all(cuerpo, "[[:digit:]]", ''))
stop_words <- as.data.frame(readLines("./data/stopwords.txt", encoding = "utf-8")) %>%     rename(word= 1)
unigram <- tabla_2 %>%
unnest_tokens(output = word, input= cuerpo, token = "ngrams", n=1) %>%
na.omit() %>%
anti_join(stop_words)
nube_f <- unigram %>%
count(word, sort =TRUE)
return(nube_f)
}
nube <-  nube(noticias)
View(nube)
wordcloud2(nube)
grafico <- function(tabla){
ggplot(tabla[1:20,], aes(x=reorder(word,n), y=n))+
geom_col(aes(fill=word),col="black")+
coord_flip()+
labs(title = paste("Cantidad de menciones en notas"),
x="Palabra", y= "Frecuencia",
caption="Elaboración propia en base a web scraping del sitio 'Diario de Pontevedra'")+
theme_minimal()+
theme(legend.position = "none")
}
grafico(nube)
tabla[1:20, ]
nube[1:20, ]
grafico <- function(tabla){
ggplot(tabla[1:20, ], aes(x=reorder(word,n), y=n))+
geom_col(aes(fill=n),col="black")+
coord_flip()+
labs(title = paste("Cantidad de menciones en notas"),
x="Palabra", y= "Frecuencia",
caption="Elaboración propia en base a web scraping del sitio 'Diario de Pontevedra'")+
theme_minimal()+
theme(legend.position = "none")
}
grafico(nube)
grafico <- function(tabla){
ggplot(tabla[1:20, ], aes(x=reorder(word,n), y=n))+
geom_col(aes(fill=n),col="black")+
coord_flip()+
labs(title = paste("Cantidad de menciones en notas"),
x="Palabra", y= "Frecuencia",
caption="Elaboración propia en base a web scraping del sitio 'Diario de Pontevedra'")+
theme_minimal()+
theme(legend.position = "none")+
scale_fill_viridis_c()
}
grafico(nube)
palabra <- readline("Ingrese la/s palabra/s clave/s: ")
if(length(palabra > 1)){
palabra <- gsub(" ", "-", palabra)
}
raiz <- "https://www.diariodepontevedra.es"
busqueda <- paste0(raiz,"/tags/" ,palabra)
lectura <- read_html(busqueda)
max_pag <- lectura %>%
html_nodes(".pagination a") %>%
html_text() %>%
as.numeric() %>%
max(na.rm = TRUE)
print(max_pag)
buscar_links <- c()
for( i in 1:max_pag){
recolectar_links <- paste0(busqueda, "?page=",i)
paginas <- read_html(recolectar_links) %>%
html_elements("h2.title") %>%
html_elements("a") %>%
html_attr("href")
paginas_completas <- str_c(raiz, paginas)
buscar_links <- append(buscar_links, paginas_completas)
}
buscar_links
print(buscar_links)
obtener_links <- function(){
palabra <<- readline("Ingrese la/s palabra/s clave/s: ")
if(length(palabra > 1)){
palabra <- gsub(" ", "-", palabra)
}
raiz <- "https://www.diariodepontevedra.es"
busqueda <- paste0(raiz,"/tags/" ,palabra)
#lectura <- read_html(busqueda)
#  Busca la pagina más alta
max_pag <- 1
repeat {
pagina_actual <- paste0(busqueda,"?page=", max_pag)
#pagina_base <- "https://www.diariodepontevedra.es/tags/buenos-aires?page="
lectura <- tryCatch(read_html(pagina_actual),
error = function(e) NULL)
if (is.null(lectura) || length(lectura %>%
html_nodes(".pagination a") %>%
html_text()
%>%
as.numeric()) == 0) {
max_pag <- max_pag - 1  # Última página válida
break
}
max_pag <- max_pag + 1
}
##
buscar_links <- c()
for( i in 1:max_pag){
recolectar_links <- paste0(busqueda, "?page=",i)
paginas <- read_html(recolectar_links) %>%
html_elements("h2.title") %>%
html_elements("a") %>%
html_attr("href")
paginas_completas <- str_c(raiz, paginas)
buscar_links <- append(buscar_links, paginas_completas)
}
return(buscar_links)
}
links_nuevos <- obtener_links()
print(links_nuevos)
source("buscar_links.R")
noticias <- tibble(
titulo=character(),
resumen=character(),
cuerpo=character(),
fecha=character(),
autor= character()
)
for(i in 1:length(buscar_links)){
print(paste("Procesando noticia: ", i))
resultado <- tabla_noticias(links_nuevos[i])
noticias <- noticias %>%
bind_rows(resultado)
}
View(noticias)
